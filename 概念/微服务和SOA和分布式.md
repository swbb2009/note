# 微服务和SOA
**微服务和SOA**
微服务也是一种服务化，不过其和SOA架构的服务化概念也是有区别的。可以从几个关键字来理解：

**松耦合：**
每个微服务内部都可以使用DDD(领域驱动设计)的思想进行设计领域模型，服务间尽量减少同步的调用，多使用消息的方式让服务间的领域事件来进行解耦。
**轻量级协议：**
Dubbo是SOA的开源的标准实现之一，类似的还有像gRPC、Thrift等。微服务更倾向于使用Restful风格的API，轻量级的协议可以很好得支持跨语言开发的服务，可能有的微服务用Java实现，有的用Go语言，有的用C++，但所有的语言都可以支持Http协议通信，所有的开发人员都能理解Restful风格API的含义。
**高度自治和持续集成：**
从底层的角度来说，SOA更加倾向于基于虚拟机或者服务器的部署，每个应用都部署在不同的机器上，一般持续集成工具更多是由运维团队写一些shell脚本以及提供基于共同协议（比如dubbo管理页面）的开发部署页面。微服务可以很好得和容器技术结合，容器技术比微服务出现得晚，但是容器技术的出现让微服务的实施更加简便。目前Docker已经成为很多微服务实践的基础容器。因为容器的特色，所以一台机器上可以部署几十个几百个不同的微服务。如果某个微服务流量压力比其他微服务大，可以在不增加机器的情况，在一台机器上多分配一些该微服务的容器实例。同时，因为Docker的容器编排社区日渐成熟，类似Mesos，Kubernetes以及Docker官方提供的swarm都可以作为持续集成部署的技术选择。
其实从架构的演进的角度来看，整体的演进都是朝着越来越轻量级，越来越灵活的应用方向。甚至到近两年日渐成熟起来的Serverless（无服务）架构。从单体服务到分层的服务，再到面向服务、再到微服务甚至无服务。对于架构的挑战是越来越大的。
**微服务架构和分布式**
微服务架构属于分布式系统吗？答案是肯定的。微服务和SOA都是典型的分布式架构，只不过微服务的部署粒度更细，服务扩展更灵活。
**理解微服务中的分布式**
怎样理解微服务中的分布式？
举一个招聘时一个来面试同学的例子。A同学，说目前所在公司在做从单应用到微服务架构迁移，已经差不多完成了。提到微服务感觉就有话题聊了，于是便问“那能简单描述下服务拆分后的部署结构、底层存储的拆分、迁移方案吗？”。于是A同学说，只是做了代码工程结构的拆分，还是原来的部署方式，数据库还是那个库，所有的微服务都用一个库，分布式事务处理方式是“避免”，尽量都同步调用……于是我就跟这位同学友好地微笑说再见了。
微服务的分布式不仅仅是容器应用层面的分布式，其为了高度自治，底层的存储体系也应该互相独立。并且也不是所有的微服务都需要持久化的存储服务。一个“手机验证码”微服务可能底层存储只用一个Redis。一个“营销活动搭建页面”微服务可能底层存储只需要一个MongoDB。
微服务中的分布式场景除了服务本身需要有**服务发现、负载均衡。微服务依赖的底层存储**也会有分布式的场景: 为了高可用性和性能需要处理数据库的复制、分区。并且存储的分库情况下，微服务需要能保证**分布式事务的一致性**。